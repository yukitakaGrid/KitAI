# KitAI システムフロー図

```
                                KitAI システム構成
                               ==================

┌─────────────────────────────────────────────────────────────────────┐
│                            main.py                                  │
│                    (メインオーケストレーター)                           │
│                                                                     │
│  ┌─────────────────┐              ┌─────────────────┐              │
│  │   task1()       │◄──events──►│   task2()       │              │
│  │  コマンドモード    │              │   編集モード    │              │
│  └─────────────────┘              └─────────────────┘              │
└─────────────────────────────────────────────────────────────────────┘
           │                                     │
           ▼                                     ▼
    
┌──────────────────┐                    ┌──────────────────┐
│   execute.py     │                    │    edit.py       │
│   (基本機能)      │                    │  (AI機能実装)     │
│                  │                    │                  │
│ • 挨拶メッセージ   │                    │ • GPT-4連携      │
│ • !edit切り替え   │                    │ • コード生成      │
│ • 基本フィルター   │                    │ • ユーザー承認    │
└──────────────────┘                    └──────────────────┘
                                               │
                                               ▼
                                    ┌──────────────────┐
                                    │  openai_bot.py   │
                                    │   (AI エンジン)   │
                                    │                  │
                                    │ • GPT-4 API連携  │
                                    │ • プロンプト最適化 │
                                    │ • コード生成      │
                                    └──────────────────┘
                                               │
                                               ▼
                                    ┌──────────────────┐
                                    │ syntax_make.py   │
                                    │  (コード統合)     │
                                    │                  │
                                    │ init.txt +       │
                                    │ register_*.txt + │
                                    │ finish.txt       │
                                    │ ↓               │
                                    │ execute_*.py    │
                                    └──────────────────┘

                              機能実装フロー
                             ===============

ユーザー要求
    │
    ▼
"@KitAI 猫語で返事する機能をお願いします"
    │
    ▼
┌─────────────────────────────────────────┐
│           edit.pyが受信                  │
│                                         │
│ 1. メッセージ解析                        │
│ 2. GPT-4にリクエスト送信                 │
│ 3. 生成コードを受信                      │
│ 4. ユーザーに確認要求                    │
└─────────────────────────────────────────┘
    │
    ▼
ユーザー承認 "Yes"
    │
    ▼
┌─────────────────────────────────────────┐
│        コード統合・実装                   │
│                                         │
│ 1. register_bot_func.txtに追加          │
│ 2. syntax_makeで3ファイル統合           │
│ 3. execute_combined.py生成              │
│ 4. モード切り替え                        │
└─────────────────────────────────────────┘
    │
    ▼
新機能付きbotが起動
    │
    ▼
猫語機能が使用可能に！

                              セキュリティレイヤー
                             ==================

┌─────────────────────────────────────────────────────────┐
│                   安全性の仕組み                         │
│                                                         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│  │  コード生成  │    │  ユーザー確認 │    │  実装・実行  │ │
│  │             │───►│             │───►│             │ │
│  │ • AI生成    │    │ • 表示       │    │ • ファイル保存│ │
│  │ • 検証      │    │ • Yes/No承認 │    │ • bot統合   │ │
│  └─────────────┘    └─────────────┘    └─────────────┘ │
│                                                         │
│             ❌ 自動実行なし - 必ず人間が確認              │
└─────────────────────────────────────────────────────────┘
```